# ðŸ“‹ Ð­Ð¢ÐÐ›ÐžÐÐÐ«Ð• SQL Ð—ÐÐŸÐ ÐžÐ¡Ð«

**Ð”Ð°Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ:** 2025-12-04  
**Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:** âœ… **ÐŸÐ ÐžÐ¢Ð•Ð¡Ð¢Ð˜Ð ÐžÐ’ÐÐÐž Ð˜ ÐŸÐžÐ”Ð¢Ð’Ð•Ð Ð–Ð”Ð•ÐÐž**  
**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹:** Ð’ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ (ÑÑƒÐ¼Ð¼Ñ‹, Ñ‡Ð°ÑˆÐºÐ¸, ÐºÐ¸Ð»Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹) ÑÐ¾Ð²Ð¿Ð°Ð´Ð°ÑŽÑ‚ Ñ ÑÑ‚Ð°Ð»Ð¾Ð½Ð¾Ð¼ Ð¸Ð· Excel (10/10 Ð·Ð°Ð¿Ð¸ÑÐµÐ¹)

---

## ðŸŽ¯ ÐžÐ‘Ð©ÐÐ¯ Ð¡Ð¢Ð Ð£ÐšÐ¢Ð£Ð Ð

Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ñ‹ Ð½Ð° **Ñ‚Ñ€Ð¸ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°** Ð´Ð»Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¿Ð¾Ð´ÑÑ‡ÐµÑ‚Ð°:
1. **Ð§Ð°ÑˆÐºÐ¸** - Ñ JOIN Ð´Ð»Ñ Ð¿Ð¾Ð´ÑÑ‡ÐµÑ‚Ð° Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²
2. **Ð¡ÑƒÐ¼Ð¼Ñ‹** - Ð‘Ð•Ð— JOIN (Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð·Ð±ÐµÐ¶Ð°Ñ‚ÑŒ Ð´ÑƒÐ±Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ)
3. **ÐšÐ¸Ð»Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹** - Ñ JOIN Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð¼ Ð¿Ð¾ ID Ð³Ñ€ÑƒÐ¿Ð¿

---

## 1ï¸âƒ£ Ð—ÐÐŸÐ ÐžÐ¡ Ð”Ð›Ð¯ Ð§ÐÐ¨Ð•Ðš

### ID Ð³Ñ€ÑƒÐ¿Ð¿ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²:

**Mono Cup (Single Origin):**
- `24435`, `25539`, `21671`, `25546`, `25775`, `25777`, `25789`

**Blend Cup (Ð¡Ð¼ÐµÑˆÐ°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ñ€Ñ‚Ð°):**
- `23076`, `21882`, `25767`, `248882`, `25788`

**Caotina Cup (Ð¨Ð¾ÐºÐ¾Ð»Ð°Ð´Ð½Ñ‹Ðµ Ð½Ð°Ð¿Ð¸Ñ‚ÐºÐ¸):**
- `24491`, `21385`

### SQL Ð·Ð°Ð¿Ñ€Ð¾Ñ:

```sql
SELECT 
    stgp.NAME AS STORE_NAME,
    D.DAT_ AS ORDER_DATE,
    SUM(CASE WHEN G.OWNER IN (?, ?, ?, ?, ?, ?, ?) THEN GD.Source ELSE NULL END) AS MonoCup,
    SUM(CASE WHEN G.OWNER IN (?, ?, ?, ?, ?) THEN GD.Source ELSE NULL END) AS BlendCup,
    SUM(CASE WHEN G.OWNER IN (?, ?) THEN GD.Source ELSE NULL END) AS CaotinaCup,
    SUM(CASE WHEN G.OWNER IN (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) THEN GD.Source ELSE NULL END) AS ALLCUP
FROM STORZAKAZDT D
JOIN STORZDTGDS GD ON D.ID = GD.SZID
JOIN GOODS G ON GD.GODSId = G.ID
JOIN STORGRP stgp ON D.STORGRPID = stgp.ID
WHERE D.STORGRPID IN (?, ?, ?, ?, ?)
  AND D.CSDTKTHBID IN ('1', '2', '3', '5')
  AND D.DAT_ >= ? AND D.DAT_ <= ?
  AND NOT (
      D.comment LIKE '%Ð¼Ñ‹;%' OR
      D.comment LIKE '%ÐœÑ‹;%' OR
      D.comment LIKE '%Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ%')
GROUP BY stgp.NAME, D.DAT_
ORDER BY stgp.NAME, D.DAT_
```

### ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ (Ð² Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ):
1. Mono Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹: `['24435', '25539', '21671', '25546', '25775', '25777', '25789']`
2. Blend Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹: `['23076', '21882', '25767', '248882', '25788']`
3. Caotina Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹: `['24491', '21385']`
4. Ð’ÑÐµ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹: `mono + blend + caotina`
5. ID Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð¾Ð²: `[27, 43, 44, 46, 33]`
6. ÐÐ°Ñ‡Ð°Ð»ÑŒÐ½Ð°Ñ Ð´Ð°Ñ‚Ð°: `'2025-12-02'`
7. ÐšÐ¾Ð½ÐµÑ‡Ð½Ð°Ñ Ð´Ð°Ñ‚Ð°: `'2025-12-03'`

### ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹:
- âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ `SUM(GD.Source)` - ÑÑ‡Ð¸Ñ‚Ð°ÐµÑ‚ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð², Ð° Ð½Ðµ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²
- âœ… JOIN Ñ `STORZDTGDS` Ð¸ `GOODS` Ð´Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº `GD.Source` Ð¸ `G.OWNER`
- âœ… Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð·Ð°ÐºÐ°Ð·Ð¾Ð² Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½

---

## 2ï¸âƒ£ Ð—ÐÐŸÐ ÐžÐ¡ Ð”Ð›Ð¯ Ð¡Ð£ÐœÐœ

### SQL Ð·Ð°Ð¿Ñ€Ð¾Ñ:

```sql
SELECT
    stgp.NAME AS STORE_NAME,
    D.DAT_ AS ORDER_DATE,
    SUM(D.SUMMA) AS TOTAL_CASH
FROM STORZAKAZDT D
JOIN STORGRP stgp ON D.STORGRPID = stgp.ID
WHERE D.STORGRPID IN (?, ?, ?, ?, ?)
  AND D.CSDTKTHBID IN ('1', '2', '3', '5')
  AND D.DAT_ >= ? AND D.DAT_ <= ?
  AND NOT (
      D.comment LIKE '%Ð¼Ñ‹;%' OR
      D.comment LIKE '%ÐœÑ‹;%' OR
      D.comment LIKE '%Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ%')
GROUP BY stgp.NAME, D.DAT_
ORDER BY stgp.NAME, D.DAT_
```

### ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:
1. ID Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð¾Ð²: `[27, 43, 44, 46, 33]`
2. ÐÐ°Ñ‡Ð°Ð»ÑŒÐ½Ð°Ñ Ð´Ð°Ñ‚Ð°: `'2025-12-02'`
3. ÐšÐ¾Ð½ÐµÑ‡Ð½Ð°Ñ Ð´Ð°Ñ‚Ð°: `'2025-12-03'`

### ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹:
- âœ… **Ð‘Ð•Ð— JOIN Ñ Ñ‚Ð¾Ð²Ð°Ñ€Ð°Ð¼Ð¸** - Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð·Ð±ÐµÐ¶Ð°Ñ‚ÑŒ Ð´ÑƒÐ±Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÑÑƒÐ¼Ð¼
- âœ… `SUM(D.SUMMA)` - ÑÑƒÐ¼Ð¼Ð° Ð²ÑÐµÐ³Ð¾ Ð·Ð°ÐºÐ°Ð·Ð°
- âœ… Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð·Ð°ÐºÐ°Ð·Ð¾Ð² Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½

---

## 3ï¸âƒ£ Ð—ÐÐŸÐ ÐžÐ¡ Ð”Ð›Ð¯ ÐšÐ˜Ð›ÐžÐ“Ð ÐÐœÐœÐžÐ’

### ID Ð³Ñ€ÑƒÐ¿Ð¿ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²:

**Blend (Ð¿Ð°Ñ‡ÐºÐ¸):**
- `11077` - Coffee Blasecafe blend (250 g)
- `16279` - Coffee Blasercafe blend (1kg)

**Mono (Ð¿Ð°Ñ‡ÐºÐ¸):**
- `16276` - Coffee Blasercafe singl origin (250Ð³)

**Ð’Ð°Ð¶Ð½Ð¾:** Caotina (package) **ÐÐ• ÑƒÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ** Ð´Ð»Ñ ÐºÐ¸Ð»Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¾Ð²!

### SQL Ð·Ð°Ð¿Ñ€Ð¾Ñ:

```sql
SELECT
    stgp.NAME AS STORE_NAME,
    D.DAT_ AS ORDER_DATE,
    SUM(GD.SOURCE) AS PACKAGES_KG
FROM STORZAKAZDT D
JOIN STORZDTGDS GD ON D.ID = GD.SZID
JOIN GOODS G ON GD.GODSId = G.ID
JOIN STORGRP stgp ON D.STORGRPID = stgp.ID
WHERE D.STORGRPID IN (?, ?, ?, ?, ?)
  AND D.CSDTKTHBID IN ('1', '2', '3', '5')
  AND D.DAT_ >= ? AND D.DAT_ <= ?
  AND G.OWNER IN (?, ?, ?)
GROUP BY stgp.NAME, D.DAT_
ORDER BY stgp.NAME, D.DAT_
```

### ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ (Ð² Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ):
1. ID Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð¾Ð²: `[27, 43, 44, 46, 33]`
2. ÐÐ°Ñ‡Ð°Ð»ÑŒÐ½Ð°Ñ Ð´Ð°Ñ‚Ð°: `'2025-12-02'`
3. ÐšÐ¾Ð½ÐµÑ‡Ð½Ð°Ñ Ð´Ð°Ñ‚Ð°: `'2025-12-03'`
4. ID Ð³Ñ€ÑƒÐ¿Ð¿: `['11077', '16279', '16276']`

### ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹:
- âœ… Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ **ID Ð³Ñ€ÑƒÐ¿Ð¿** (`G.OWNER IN (...)`), Ð° Ð½Ðµ Ð¿Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑÐ¼ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²
- âœ… **Ð‘Ð•Ð— Caotina** - Ð³Ñ€ÑƒÐ¿Ð¿Ð° `22939` Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð°
- âœ… **Ð‘Ð•Ð— Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð° Ð¿Ð¾ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÑÐ¼** - ÐºÐ°Ðº Ð² ÑÑ‚Ð°Ñ€Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐ¹ Ð²ÐµÑ€ÑÐ¸Ð¸
- âœ… `SUM(GD.SOURCE)` - ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿Ð°Ñ‡ÐµÐº (Ð½Ðµ ÑƒÐ¼Ð½Ð¾Ð¶Ð°ÐµÐ¼ Ð½Ð° Ð²ÐµÑ!)

---

## ðŸ”— ÐžÐ‘ÐªÐ•Ð”Ð˜ÐÐ•ÐÐ˜Ð• Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢ÐžÐ’

ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ñ‚Ñ€ÐµÑ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð², Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÑÑŽÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· `MERGE`:

```python
df = df_cups.merge(
    df_sums,
    on=["STORE_NAME", "ORDER_DATE"],
    how="outer",
).merge(
    df_packages,
    on=["STORE_NAME", "ORDER_DATE"],
    how="outer",
)
```

---

## âš ï¸ Ð’ÐÐ–ÐÐ«Ð• Ð—ÐÐœÐ•Ð§ÐÐÐ˜Ð¯

### 1. Ð Ð°Ð·Ð´ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹
- **ÐÐ• Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÑÐ¹Ñ‚Ðµ** Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð´Ð»Ñ Ñ‡Ð°ÑˆÐµÐº Ð¸ ÑÑƒÐ¼Ð¼ Ð² Ð¾Ð´Ð¸Ð½ Ñ JOIN - ÑÑ‚Ð¾ Ð¿Ñ€Ð¸Ð²ÐµÐ´ÐµÑ‚ Ðº Ð´ÑƒÐ±Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÑŽ ÑÑƒÐ¼Ð¼
- Ð¡ÑƒÐ¼Ð¼Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ ÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒÑÑ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾, Ð±ÐµÐ· JOIN Ñ Ñ‚Ð¾Ð²Ð°Ñ€Ð°Ð¼Ð¸

### 2. Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÑÐ¼
- **ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½** Ð´Ð»Ñ Ñ‡Ð°ÑˆÐµÐº Ð¸ ÑÑƒÐ¼Ð¼: `NOT (D.comment LIKE '%Ð¼Ñ‹;%' OR ...)`
- **ÐÐ• Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ** Ð´Ð»Ñ ÐºÐ¸Ð»Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¾Ð² (ÐºÐ°Ðº Ð² ÑÑ‚Ð°Ñ€Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐ¹ Ð²ÐµÑ€ÑÐ¸Ð¸)

### 3. COUNT(*) vs SUM(GD.Source)
- âŒ **ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾:** `COUNT(*)` - ÑÑ‡Ð¸Ñ‚Ð°ÐµÑ‚ Ð·Ð°ÐºÐ°Ð·Ñ‹
- âœ… **ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾:** `SUM(GD.Source)` - ÑÑ‡Ð¸Ñ‚Ð°ÐµÑ‚ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹

### 4. ID Ð³Ñ€ÑƒÐ¿Ð¿ vs Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ
- âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ **ID Ð³Ñ€ÑƒÐ¿Ð¿** (`G.OWNER IN (...)`), Ð° Ð½Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²
- Ð­Ñ‚Ð¾ Ñ‚Ð¾Ñ‡Ð½ÐµÐµ Ð¸ Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ

### 5. Caotina Ð´Ð»Ñ ÐºÐ¸Ð»Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¾Ð²
- âŒ **ÐÐ• Ð²ÐºÐ»ÑŽÑ‡Ð°Ð¹Ñ‚Ðµ** Caotina (ID `22939`) Ð² Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð´Ð»Ñ ÐºÐ¸Ð»Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¾Ð²
- Ð’ Excel ÐºÐ¸Ð»Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ ÑÑ‡Ð¸Ñ‚Ð°ÑŽÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Blend Ð¸ Mono Ð¿Ð°Ñ‡ÐµÐº

---

## ðŸ“Š ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢ÐžÐ’

### ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ (Ð¿ÐµÑ€Ð¸Ð¾Ð´ 02-03.12.2025):

**Ð¡ÑƒÐ¼Ð¼Ñ‹:**
- BatumiMall: 608.55, 861.95
- CityMall: 698.05, 809.85
- DK Batumi: 342.00, 1014.55
- DK Paliashvili: 2874.00, 640.25
- EastPoint: 452.05, 509.00

**ÐšÐ¸Ð»Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹:**
- BatumiMall: 0.25, 1.50
- CityMall: 1.00, 1.75
- DK Batumi: 0.75, 4.25
- DK Paliashvili: 3.00, 3.50
- EastPoint: 0.25, 0.50

**Ð§Ð°ÑˆÐºÐ¸:** ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑŽÑ‚ÑÑ Ð¿Ð¾ Ñ‚Ð¸Ð¿Ð°Ð¼ (CCup, MCup, BCup)

---

## ðŸ”§ Ð Ð•ÐÐ›Ð˜Ð—ÐÐ¦Ð˜Ð¯ Ð’ ÐšÐžÐ”Ð•

Ð¡Ð¼. `src/proxy_api_connector.py` - Ð¼ÐµÑ‚Ð¾Ð´ `get_sales_data()` Ð´Ð»Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸.

